language: python
python:
- '3.6'
sudo: required
services:
- docker
cache: pip
env:
  global:
  - HELM_VERSION="v2.8.2"
  - DOCKER_USERNAME=captainfiaas
  - secure: "UjMQSuMaNIspRCrpoBIVppOeeABcvqpKzD6oozVXZ97b1LkmRXRfHEpjUxWNC/G7mkexCnr0PncSgU0oOO2rWKlGxASuS1rYuMmzRvduW7/LmTnX+b7D22LXZ6bjpvKpPLpMAcCfiNry1xFpDAp7H+4GHxcRACCOkfc3mKKIYJuKbk0oE1xjx85RUQG5Am9pLvNLgWwSgdesKf14xtzFey1aCNZeP2Ye0j/3DE7H5ugZ98J5Aj1yA+hoyLpUuZTSef7s++chqNGpunkZcRAnecutJ9GKvO73spu60ozbDz5C0tnKABquSPfQSTBdbcQ02Go9dO3Ypl/A6dKT314cMjYwDeHWJftcuyRdw22m+hj5kcDDSb2vWLb+DBE6uUpCfdROl+cSOY596VP0Z9Mjjqo8waX/p23JJMaZ+VUQxfw+FiUHc8AeOVqrjJ9EqhnJQ70gCWx5LSLAhhtunoaKfVlAaz4Pm9XO5LnSnFfuMtWggT2RpDsLhRjr86vYmxY90lEvESmQyhmUUh9CqTu+EuNJ7dK1gOUH91OqU0FwlJRrihbDeovHeovtFGjUr3GjOq2dreNvxlOj9xbqB/OmO4bfOYqsHQq8HWxVt/YQ5ubdsHE+59G+N7e9XyFP1NDRhRUFrsRJhihRG/tqcfCVxUNmj9YN3oGEzOm6zttLQkc=" # DOCKER_PASSWORD
install:
- pip install -e .[ci]
script:
  - tox
  - bin/docker_build
after_success:
- tox -e coverage
deploy:
  provider: script
  script: VERSION=$(python setup.py --version) TAG=$(bin/tag_release|tail -1) bash -c 'bin/docker_push && bin/publish_helm_chart'
  skip_cleanup: true
  on:
    branch: master
