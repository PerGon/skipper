#!/usr/bin/env bash

set -evuo pipefail

VERSION=$(python setup.py --version)
DOCKER_IMAGE="fiaas/skipper:${VERSION/+/-}"

echo "${DOCKER_PASSWORD}" | docker login -u "${DOCKER_USERNAME}" --password-stdin

docker build . -t "${DOCKER_IMAGE}"

if [[ "${CI}" == "true" ]]; then
    docker push "${DOCKER_IMAGE}"
    echo "Pushed image ${DOCKER_IMAGE}"
fi
